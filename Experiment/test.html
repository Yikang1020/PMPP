<!DOCTYPE html>
<html>
<head>
  <script src="jspsych/dist/jspsych.js"></script>
  <script src="jspsych/dist/plugin-fullscreen.js"></script>
  <script src="jspsych/dist/plugin-instructions.js"></script>
  <script src="jspsych/dist/plugin-image-keyboard-response.js"></script>
  <script src="jspsych/dist/plugin-reconstruct-wheel.js"></script>
  <script src="jspsych/dist/plugin-html-button-response.js"></script>
  <script src="jspsych/dist/plugin-html-keyboard-response.js"></script>
  <script src="jspsych/dist/extension-mouse-tracking.js"></script>
  <script src="jspsych/dist/plugin-preload.js"></script>
  <link rel="stylesheet" href="jspsych/dist/jspsych.css">
</head>
<body></body>
<script>

  var jsPsych = initJsPsych({
    extensions:[{type: jsPsychExtensionMouseTracking, 
                 params: {minimum_sample_time: 0}},
    ]
  });


  var fullscreen_trial = {
    type: jsPsychFullscreen,
    fullscreen_mode: true
  };



  // all images are used in standard trials that can be automatically preloaded (as well as being used in trials 
  // that use timeline variables), so we can preload all image files with the auto_preload option
 
  var stim_images = ['img/materials/stim1.jpg','img/materials/stim2.jpg'];
  var recon_images = [];
  for (i = 0; i <360; i++){
    recon_images.push('img/sceneWheel_images_webp/Wheel01/wheel01_r02/'+('00000'+i).slice(-6).toString()+'.webp')
  }

  var preload_images = [stim_images];
  preload_images.push([recon_images]);

  var preload = {
    type: jsPsychPreload,
    images: preload_images,
    auto_preload: true
  };

  var instructions = {
    type: jsPsychInstructions,
    pages: ['<p>测试</p><p>Custom "Page X/Y" and next/previous button labels provide support for different languages.</p>',
      '<p>This is the second page of instructions.</p>',
      '<p>This is the final page.</p>'],
    show_clickable_nav: true,
    show_page_number: true,
    button_label_previous: 'Previous',
    button_label_next: 'Next',
    page_label: 'Page',
  };

  var cue = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<p style="color: green; font-size: 48px; font-weight: bold;">GREEN</p>',
    choices: "NO_KEYS",
    trial_duration: 2000,
  prompt: '<p>No response allowed. 2s wait.</p>'
  }

  var target = {
    type: jsPsychImageKeyboardResponse,
    stimulus: jsPsych.timelineVariable('stim'),
    trial_duration: 3000,
    prompt: '<p>Watch the faces.</p>',
    stimulus_width: 400, 
    maintain_aspect_ratio: true,
    post_trial_gap: 0,
  };


  var judgement = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<p style="color: black; font-size: 48px; font-weight: bold;">congruent</p>'+
      '<p style="color: black; font-size: 30px; font-weight: bold;">vs</p>'+
      '<p style="color: black; font-size: 48px; font-weight: bold;">incongruent</p>',
    choices: ['f','j'],
    //trial_duration: 5000,
    prompt: '<p>No response allowed. 2s wait.</p>'
  };

  
  var recon = {
    type: jsPsychReconstruct_wheel,
    image_path: 'img/sceneWheel_images_webp/Wheel01/wheel01_r02',
    image_format: 'webp',
    uncertainty_range: true
  }
  
  var trial_proc = {
    timeline: [cue, target, judgement, recon],
    timeline_variables: [ 
      {stim: 'img/materials/stim1.jpg'},
      {stim: 'img/materials/stim2.jpg'}
    ],
    repetitions: 3,
    loop_function: function() {
      return true;
    }
  };
  
  if (typeof jsPsych !== "undefined") {
    jsPsych.run([fullscreen_trial, preload, instructions, trial_proc]);
  } else {
    document.body.innerHTML = '<div style="text-align:center; margin-top:50%; transform:translate(0,-50%);">You must be online to view the plugin demo.</div>';
  }


</script>
</html>